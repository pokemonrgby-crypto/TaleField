# 엔진 스케치 — 미니 DSL & 타이밍/스택

## 타이밍 창(순서)
1) 턴 시작
2) 드로우 전/후
3) 카드 사용 선언
4) 코스트 최종 확정/지불
5) 대상 고르기
6) 효과 블록 스택에 올리기
7) **반응 창** (있으면 반응을 스택에 추가, LIFO)
8) 스택 해결 (위→아래)
9) 피해/회복 정산
10) 턴 종료 전/후

## 레이어(계산 순서)
- 기본값 → 고정값 설정 → 더하기/빼기 → 곱/나누기 → 최솟값/최댓값

## 동사(액션) 목록(초안)
- `대상고르기(조건)` — 자신/적1/전원/아군전체 등
  - **다자간 전투 확장**: `all_enemies`(모든 적), `all_players`(전체), `random_enemy`(무작위 적), `lowest_hp_enemy`(최저 체력 적) 등
- `피해(누구, 수치, {관통?})`
- `회복(누구, 수치)`
- `보호막(누구, 수치)`
- `드로우(누구, 장수)` / `버림(누구, 장수)`
- `기력변화(누구, +n/-n)`
- `표식추가/제거(누구, 이름, {턴수?, 사용후제거?})`
- `쿨다운설정(누구, 이름, 턴수)`
- `지속등록(누구, "이름", {{타이밍, 본문:[…]}})`
- `만약(조건) → [블록A] 아니면 [블록B]`
- `반응창열기()`
- `로그(문장)`
- `흡혈(누구, 수치)` — 피해를 주고 같은 양만큼 회복
- `확률(확률값, 성공시:[…], 실패시:[…])` — 랜덤 효과

## 조건 예시
- `내HP < 상대HP`, `손패 ≥ 1`, `이번턴_반응사용횟수 < 2`, `표식("봉인") 없음`

## 무한루프 방지
- 카드 1장 실행당 최대 20스텝.
- 지연(예약) 효과는 플레이어당 최대 3개.
- 동일 표식 2중첩 제한.

## 난수
- 방마다 시드 고정. 로그 저장으로 재현 가능.
