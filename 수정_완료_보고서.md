# ğŸ¯ TaleField ë²„ê·¸ ìˆ˜ì • ì™„ë£Œ ë³´ê³ ì„œ

## ğŸ“‹ ì‘ì—… ê°œìš”

**í”„ë¡œì íŠ¸**: TaleField (ê°“í•„ë“œ)  
**ì‘ì—… ì¼ì‹œ**: 2025-10-23  
**Firebase í”„ë¡œì íŠ¸ ID**: peaceful-doodad-471301-s2  
**ì‘ì—… ë‚´ìš©**: êµ¬ê¸€ ë¡œê·¸ì¸, AI ë´‡ ê°œìˆ˜ ì„¤ì •, ë´‡ ë°© ìë™ ì‚­ì œ ê¸°ëŠ¥ ìˆ˜ì •

---

## ğŸ” ìˆ˜ì •ëœ ë¬¸ì œ ìš”ì•½

### 1. êµ¬ê¸€ ë¡œê·¸ì¸ ë¬¸ì œ
**ë¬¸ì œì **: íŒì—… ì°¨ë‹¨ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë¡œê·¸ì¸ í›„ ê²°ê³¼ ì²˜ë¦¬ ì•ˆ ë¨  
**í•´ê²°**: `getRedirectResult()` ì¶”ê°€ë¡œ ìë™ ë¡œê·¸ì¸ ì™„ë£Œ ì²˜ë¦¬

### 2. AI ë´‡ ê°œìˆ˜ ì„¤ì • ë¶ˆê°€
**ë¬¸ì œì **: ë´‡ì´ 1ê°œë¡œ ê³ ì •ë˜ì–´ ìˆìŒ  
**í•´ê²°**: UIì™€ ë°±ì—”ë“œì— ë´‡ ê°œìˆ˜ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€ (1~7ê°œ)

### 3. ë´‡ ë°© ìë™ ì‚­ì œ ì•ˆ ë¨
**ë¬¸ì œì **: í”Œë ˆì´ì–´ê°€ ë‚˜ê°€ë„ ë´‡ë§Œ ë‚¨ì•„ ë°©ì´ ìœ ì§€ë¨  
**í•´ê²°**: ì‹¤ì œ í”Œë ˆì´ì–´ê°€ 0ëª…ì´ ë˜ë©´ ë´‡ ë°© ìë™ ì‚­ì œ

---

## ğŸ“ ìƒì„¸ ë³€ê²½ ë‚´ì—­

### 1ï¸âƒ£ êµ¬ê¸€ ë¡œê·¸ì¸ ê°œì„  (`public/js/firebase.js`)

#### ë³€ê²½ ì „
```javascript
export async function signInWithGoogle() {
  try {
    return await signInWithPopup(auth, provider);
  } catch (e) {
    return signInWithRedirect(auth, provider);
  }
}
```

#### ë³€ê²½ í›„
```javascript
// getRedirectResult import ì¶”ê°€
import { getRedirectResult, ... } from "firebase/auth";

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²°ê³¼ ìë™ ì²˜ë¦¬
getRedirectResult(auth)
  .then((result) => {
    if (result) {
      console.log("Google ë¡œê·¸ì¸ ì„±ê³µ:", result.user.email);
    }
  })
  .catch((error) => {
    console.error("Google ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì˜¤ë¥˜:", error);
    // ì‚¬ìš©ì ì¹œí™”ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
    if (error.code === 'auth/popup-blocked') {
      alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
    } else if (error.code === 'auth/popup-closed-by-user') {
      // ì‚¬ìš©ìê°€ íŒì—…ì„ ë‹«ì€ ê²½ìš°ëŠ” ë¬´ì‹œ
    } else {
      alert(`ë¡œê·¸ì¸ ì˜¤ë¥˜: ${error.message}`);
    }
  });

export async function signInWithGoogle() {
  try {
    const result = await signInWithPopup(auth, provider);
    console.log("Google ë¡œê·¸ì¸ ì„±ê³µ (íŒì—…):", result.user.email);
    return result;
  } catch (e) {
    console.log("íŒì—… ë¡œê·¸ì¸ ì‹¤íŒ¨, ë¦¬ë‹¤ì´ë ‰íŠ¸ë¡œ ì „í™˜:", e.code);
    // íŒì—…ì´ ì°¨ë‹¨ëœ ê²½ìš°ì—ë§Œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‚¬ìš©
    if (e.code === 'auth/popup-blocked' || e.code === 'auth/cancelled-popup-request') {
      return signInWithRedirect(auth, provider);
    }
    throw e;
  }
}
```

**íš¨ê³¼**:
- íŒì—… ì°¨ë‹¨ í™˜ê²½ì—ì„œë„ ì •ìƒ ë¡œê·¸ì¸ ê°€ëŠ¥
- ë¦¬ë‹¤ì´ë ‰íŠ¸ í›„ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ ì™„ë£Œ
- ëª…í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¡œ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

---

### 2ï¸âƒ£ ë´‡ ê°œìˆ˜ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€

#### A. UI ìˆ˜ì • (`public/index.html`)

**ì¶”ê°€ëœ ìš”ì†Œ**:
```html
<label style="color: var(--ink-main);">
  ë´‡ ê°œìˆ˜:
  <select id="bot-count" style="margin-left: 8px; width: 100px;">
    <option value="1" selected>1ê°œ</option>
    <option value="2">2ê°œ</option>
    <option value="3">3ê°œ</option>
    <option value="4">4ê°œ</option>
    <option value="5">5ê°œ</option>
    <option value="6">6ê°œ</option>
    <option value="7">7ê°œ</option>
  </select>
</label>
```

#### B. í”„ë¡ íŠ¸ì—”ë“œ ë¡œì§ (`public/js/tabs/lobby.js`)

**ë³€ê²½ ì „**:
```javascript
async function handleCreateBotRoom() {
    const difficulty = botDifficultySelect.value || 'NORMAL';
    const result = await callCreateBotRoom({ 
        difficulty, 
        title: 'ë´‡ ë°°í‹€' 
    });
}
```

**ë³€ê²½ í›„**:
```javascript
async function handleCreateBotRoom() {
    const difficulty = botDifficultySelect.value || 'NORMAL';
    const botCount = parseInt(botCountSelect?.value || '1', 10);
    const result = await callCreateBotRoom({ 
        difficulty, 
        botCount,
        title: 'ë´‡ ë°°í‹€' 
    });
}
```

#### C. ë°±ì—”ë“œ í•¨ìˆ˜ (`functions/index.js`)

**ë³€ê²½ëœ ë¶€ë¶„**:
```javascript
export const createBotRoom = functions
  .region("asia-northeast3")
  .https.onCall(async (data, context) => {
    // ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸: botCount ì¶”ê°€
    const { difficulty, botCount, title } = z.object({
      difficulty: z.enum(['EASY', 'NORMAL', 'HARD']).default('NORMAL'),
      botCount: z.number().int().min(1).max(7).default(1), // ìƒˆë¡œ ì¶”ê°€
      title: z.string().min(2).max(50).default('ë´‡ ë°°í‹€')
    }).parse(data);

    // í”Œë ˆì´ì–´ ë°°ì—´ ìƒì„± (ìœ ì € 1ëª… + ë´‡ë“¤)
    const players = [
      { uid, nickname, isHost: true, ready: false, isBot: false, ... }
    ];

    // ë´‡ í”Œë ˆì´ì–´ ì¶”ê°€ (ë°˜ë³µë¬¸ìœ¼ë¡œ ì—¬ëŸ¬ ë´‡ ìƒì„±)
    for (let i = 0; i < botCount; i++) {
      players.push({
        uid: `bot_${i + 1}`,
        nickname: `ì²œê³„ì˜ ìˆ˜í˜¸ì ${i + 1} (${difficulty})`,
        isHost: false,
        ready: true,
        isBot: true,
        shinId: 'bot_shin',
        selectedArtifactIds: []
      });
    }

    // ë°© ë°ì´í„°ì— botCount ì €ì¥
    const roomData = {
      title: `${title} (${botCount}ë´‡ vs 1ì¸, ${difficulty})`,
      maxPlayers: botCount + 1,
      playerUids: [uid, ...Array.from({ length: botCount }, (_, i) => `bot_${i + 1}`)],
      botCount: botCount,
      players: players,
      ...
    };
  });
```

**íš¨ê³¼**:
- ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë§Œí¼ ë´‡ ìƒì„± ê°€ëŠ¥ (1~7ê°œ)
- ê° ë´‡ì— ê³ ìœ  IDì™€ ì´ë¦„ ë¶€ì—¬
- ë°© ì œëª©ì— ë´‡ ê°œìˆ˜ ëª…í™•íˆ í‘œì‹œ

---

### 3ï¸âƒ£ ë´‡ ë°© ìë™ ì‚­ì œ (`functions/index.js`)

**ë³€ê²½ ì „**:
```javascript
export const leaveRoom = functions.https.onCall(async (data, context) => {
  const players = roomData.players.filter(p => p.uid !== uid);
  
  if (players.length === 0) {
    // ë§ˆì§€ë§‰ í”Œë ˆì´ì–´ê°€ ë‚˜ê°€ë©´ ë°© ì‚­ì œ
    tx.delete(roomRef);
  } else {
    // í”Œë ˆì´ì–´ ëª©ë¡ ì—…ë°ì´íŠ¸
    tx.update(roomRef, { players, ... });
  }
});
```

**ë³€ê²½ í›„**:
```javascript
export const leaveRoom = functions.https.onCall(async (data, context) => {
  const players = roomData.players.filter(p => p.uid !== uid);
  
  // ì‹¤ì œ í”Œë ˆì´ì–´(ë´‡ì´ ì•„ë‹Œ) ìˆ˜ë¥¼ ê³„ì‚°
  const realPlayers = players.filter(p => !p.isBot);
  
  // ë´‡ ë°©ì´ê³  ì‹¤ì œ í”Œë ˆì´ì–´ê°€ ì—†ìœ¼ë©´ ë°© ì‚­ì œ
  if (roomData.isBotRoom && realPlayers.length === 0) {
    console.log(`ë´‡ ë°© ${roomId}ì—ì„œ ë§ˆì§€ë§‰ í”Œë ˆì´ì–´ê°€ ë‚˜ê°”ìŠµë‹ˆë‹¤. ë°©ì„ ì‚­ì œí•©ë‹ˆë‹¤.`);
    tx.delete(roomRef);
    return;
  }
  
  // ëª¨ë“  í”Œë ˆì´ì–´ê°€ ë‚˜ê°”ìœ¼ë©´ ë°© ì‚­ì œ
  if (players.length === 0) {
    tx.delete(roomRef);
  } else {
    // ë°©ì¥ì´ ë‚˜ê°”ì„ ê²½ìš°, ë‹¤ìŒ ì‹¤ì œ í”Œë ˆì´ì–´ì—ê²Œ ë°©ì¥ ìœ„ì„
    if (roomData.hostUid === uid) {
      const nextHost = realPlayers.length > 0 ? realPlayers[0] : players[0];
      updateData.hostUid = nextHost.uid;
      updateData.hostNickname = nextHost.nickname;
      nextHost.isHost = true;
    }
    tx.update(roomRef, updateData);
  }
});
```

**íš¨ê³¼**:
- ë´‡ë§Œ ë‚¨ì€ ë°©ì€ ì¦‰ì‹œ ì‚­ì œë˜ì–´ ë°© ëª©ë¡ ì •ë¦¬
- ì¼ë°˜ ë°©ì€ ê¸°ì¡´ ë°©ì‹ëŒ€ë¡œ ë™ì‘
- ë°©ì¥ ìœ„ì„ ë¡œì§ë„ ë´‡ì„ ì œì™¸í•˜ê³  ì²˜ë¦¬

---

### 4ï¸âƒ£ ë´‡ ê²Œì„ ì‹œì‘ ì²˜ë¦¬ (`functions/index.js`)

**ì¶”ê°€ëœ ë¡œì§**:
```javascript
// startGame í•¨ìˆ˜ ë‚´
if (isGodFieldMode) {
  // ì‹  ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const shinPromises = roomData.players.map(p => {
    if (p.isBot) {
      // ë´‡ì€ Firestore ì¡°íšŒ ì—†ì´ null ë°˜í™˜
      return Promise.resolve({ exists: true, data: () => null });
    }
    return db.doc(`shin/${p.shinId}`).get();
  });
  
  // ë´‡ ì‹  ë°ì´í„° í•˜ë“œì½”ë”©
  const shins = shinSnaps.map((snap, idx) => {
    if (roomData.players[idx].isBot) {
      return {
        name: "ì²œê³„ì˜ ìˆ˜í˜¸ì",
        description: "ì²œê³„ë¥¼ ì§€í‚¤ëŠ” ê°•ë ¥í•œ ì‹ ...",
        uniqueMiracles: [ /* ë¯¸ë¦¬ ì •ì˜ëœ ê¸°ì ë“¤ */ ]
      };
    }
    return snap.data();
  });
  
  // ë´‡ ë± í•˜ë“œì½”ë”©
  const allArtifacts = artifactSnaps.flatMap((snap, idx) => {
    if (roomData.players[idx].isBot) {
      return [ /* ë¯¸ë¦¬ ì •ì˜ëœ 7ê°œ ì¹´ë“œ */ ];
    }
    return snap.docs.map(d => d.data());
  });
  
  // ë§¤ì¹˜ í”Œë ˆì´ì–´ ê°ì²´ì— isBot í”Œë˜ê·¸ ì¶”ê°€
  matchPlayers[p.uid] = {
    uid: p.uid,
    nickname: p.nickname,
    isBot: p.isBot || false, // ìƒˆë¡œ ì¶”ê°€
    hp: 40,
    mp: 10,
    ...
  };
}
```

**íš¨ê³¼**:
- ë´‡ í”Œë ˆì´ì–´ëŠ” Firestore ì¡°íšŒ ì—†ì´ ê²Œì„ ì‹œì‘
- ì„±ëŠ¥ í–¥ìƒ ë° ì˜¤ë¥˜ ë°©ì§€
- ë´‡ ë±ì€ `data/bot-config.js`ì˜ ì •ì˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë“œì½”ë”©

---

## ğŸ“Š ìˆ˜ì • íŒŒì¼ ìš”ì•½

| íŒŒì¼ | ë³€ê²½ ë‚´ìš© | ë¼ì¸ ìˆ˜ |
|------|----------|---------|
| `public/js/firebase.js` | ë¡œê·¸ì¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬ ì¶”ê°€ | +30 |
| `public/index.html` | ë´‡ ê°œìˆ˜ ì„ íƒ UI ì¶”ê°€ | +9 |
| `public/js/tabs/lobby.js` | ë´‡ ê°œìˆ˜ ì „ì†¡ ë¡œì§ | +2 |
| `functions/index.js` | createBotRoom, leaveRoom, startGame ê°œì„  | +120 |
| **ì´ê³„** | - | **+161** |

---

## âœ… í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ìë™ ê²€ì¦ (ì™„ë£Œ)
- âœ… JavaScript ë¬¸ë²• ê²€ì¦: ëª¨ë“  íŒŒì¼ í†µê³¼
- âœ… Firebase Functions ë¹Œë“œ: ì •ìƒ
- âœ… ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬: ì •ìƒ

### ìˆ˜ë™ í…ŒìŠ¤íŠ¸ (ê¶Œì¥)
- [ ] êµ¬ê¸€ ë¡œê·¸ì¸ (íŒì—…/ë¦¬ë‹¤ì´ë ‰íŠ¸)
- [ ] ë´‡ 1ê°œ ë°© ìƒì„± ë° ê²Œì„ ì‹œì‘
- [ ] ë´‡ ì—¬ëŸ¬ ê°œ ë°© ìƒì„± ë° ê²Œì„ ì‹œì‘
- [ ] ë´‡ ë°© ë‚˜ê°€ê¸° ì‹œ ìë™ ì‚­ì œ í™•ì¸
- [ ] ì¼ë°˜ ë°© ë™ì‘ í™•ì¸ (ë´‡ ì—†ìŒ)

---

## ğŸš€ ë°°í¬ ë°©ë²•

### Firebase ë°°í¬
```bash
# Functions ë°°í¬
cd functions
npm install
cd ..
firebase deploy --only functions

# Hosting ë°°í¬ (í”„ë¡ íŠ¸ì—”ë“œ)
firebase deploy --only hosting
```

### ë°°í¬ í™•ì¸
1. [Firebase Console](https://console.firebase.google.com/project/peaceful-doodad-471301-s2) ì ‘ì†
2. Functions íƒ­ì—ì„œ ë°°í¬ ìƒíƒœ í™•ì¸
3. Hosting íƒ­ì—ì„œ ë°°í¬ëœ URL í™•ì¸

---

## ğŸ“Œ ì•Œë ¤ì§„ ì œí•œì‚¬í•­

1. **ë´‡ AI ë‹¨ìˆœì„±**: í˜„ì¬ ë´‡ì€ ê¸°ë³¸ì ì¸ ê·œì¹™ ê¸°ë°˜ AI
   - ë¬´ê¸° ìˆìŒ â†’ ê³µê²©
   - ë¬´ê¸° ì—†ìŒ â†’ ê¸°ë„
   
2. **ë´‡ ë± ê³ ì •**: ëª¨ë“  ë´‡ì´ ë™ì¼í•œ ë± ì‚¬ìš©
   - ë‚œì´ë„ë³„ ë‹¤ë¥¸ ë±ì€ í–¥í›„ ê°œì„  ì‚¬í•­

3. **ìµœëŒ€ ë´‡ ìˆ˜ ì œí•œ**: 7ê°œë¡œ ì œí•œ
   - ê²Œì„ ë°¸ëŸ°ìŠ¤ì™€ UI ê³ ë ¤

---

## ğŸ”® í–¥í›„ ê°œì„  ì‚¬í•­

### ë‹¨ê¸° (1ì£¼ì¼)
- [ ] ë´‡ AI ê°œì„  (í™•ë¥  ê¸°ë°˜ â†’ ì „ëµ ê¸°ë°˜)
- [ ] ë‚œì´ë„ë³„ ë‹¤ë¥¸ ë´‡ ë± êµ¬ì„±
- [ ] ë´‡ í„´ ì‹œê° íš¨ê³¼ ì¶”ê°€

### ì¤‘ê¸° (1ê°œì›”)
- [ ] ë´‡ê³¼ì˜ ë©€í‹°í”Œë ˆì´ ì§€ì› (2ì¸ vs 2ë´‡ ë“±)
- [ ] ë´‡ í”„ë¦¬ì…‹ ì„ íƒ ê¸°ëŠ¥
- [ ] ê²Œì„ í†µê³„ ë° ìŠ¹ë¥  ì¶”ì 

### ì¥ê¸° (3ê°œì›”)
- [ ] ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ ë´‡ AI
- [ ] í† ë„ˆë¨¼íŠ¸ ëª¨ë“œ (ë´‡ í¬í•¨)
- [ ] ì»¤ìŠ¤í…€ ë´‡ ìƒì„± ê¸°ëŠ¥

---

## ğŸ“ ë¬¸ì œ ë³´ê³ 

ë¬¸ì œ ë°œìƒ ì‹œ ë‹¤ìŒ ì •ë³´ì™€ í•¨ê»˜ GitHub Issueì— ë³´ê³ :
1. ë¸Œë¼ìš°ì € ë° ë²„ì „
2. ë¬¸ì œ ë°œìƒ ë‹¨ê³„
3. ì½˜ì†” ì˜¤ë¥˜ ë©”ì‹œì§€
4. ì¬í˜„ ë°©ë²•

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [Firebase Authentication Guide](https://firebase.google.com/docs/auth/web/google-signin)
- [Firestore Security Rules](https://firebase.google.com/docs/firestore/security/get-started)
- [Cloud Functions for Firebase](https://firebase.google.com/docs/functions)

---

**ì‘ì„±ì¼**: 2025-10-23  
**ì‘ì„±ì**: GitHub Copilot  
**ê²€í† ì**: pokemonrgby-crypto  
**ìƒíƒœ**: âœ… êµ¬í˜„ ì™„ë£Œ, í…ŒìŠ¤íŠ¸ ëŒ€ê¸°ì¤‘
