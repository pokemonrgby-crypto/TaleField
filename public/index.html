<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaleField :: Reborn</title>
  <link rel="stylesheet" href="./style.css">
  
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://www.gstatic.com https://apis.google.com;
  connect-src 'self'
    https://firestore.googleapis.com
    https://identitytoolkit.googleapis.com
    https://securetoken.googleapis.com
    https://firebaseinstallations.googleapis.com
    https://www.googleapis.com
    https://www.gstatic.com
    https://asia-northeast3-peaceful-doodad-471301-s2.cloudfunctions.net;
  frame-src 'self' https://accounts.google.com https://apis.google.com https://www.gstatic.com;
  img-src 'self' data: https:;
  style-src 'self' 'unsafe-inline';
">
</head>
<body>

  <div id="top-right-container">
    <button id="btn-logout" class="btn" style="display:none;">로그아웃</button>
  </div>

  <main>
    <section id="view-lobby" class="active">
      <h1 class="page-title">로비</h1>
      <div class="toolbar">
        <input id="room-title-input" placeholder="방 제목 (2~20자)" maxlength="20" style="flex-grow:1;">
        <button id="btn-create-room" class="btn primary">방 만들기</button>
      </div>
      <ul id="room-list" class="room-list-container"></ul>
      <p id="lobby-status" class="muted"></p>
    </section>

    <section id="view-room">
      <div class="room-header">
        <h1 id="room-title" class="page-title">게임 룸</h1>
        <div>
          <button id="btn-leave-room" class="btn">나가기</button>
          <button id="btn-start-game" class="btn primary large" style="display:none;">게임 시작</button>
        </div>
      </div>
      <div class="room-layout">
        <div class="player-list-container">
            <h3>플레이어</h3>
            <ul id="player-list"></ul>
        </div>
        <div class="selection-container">
          <div id="character-selection-area">
            <h3>캐릭터 선택</h3>
            <div id="room-my-characters" class="card-grid small"></div>
          </div>
          <div id="skill-selection-area" style="display:none;">
            <h3 id="skill-selection-title">스킬 선택 (2개)</h3>
            <div id="room-my-skills"></div>
          </div>
        </div>
        <div class="card-selection-container">
            <h3>내 카드 덱 (5~10장 선택)</h3>
            <p class="muted">현재 <span id="room-selected-card-count">0</span>장 선택됨</p>
            <div id="room-my-cards" class="card-grid small"></div>
            <button id="btn-ready" class="btn primary" style="margin-top: 16px;">준비 완료</button>
        </div>
      </div>
    </section>
    
    <section id="view-my-characters">
        <h1 class="page-title">내 캐릭터</h1>
        <div class="toolbar">
            <button id="btn-refresh-my-chars" class="btn">새로고침</button>
            <span id="my-chars-status" class="muted">내가 생성한 캐릭터 목록입니다.</span>
        </div>
        <div id="my-chars-grid" class="card-grid"></div>
    </section>

    <section id="view-my-cards">
        <h1 class="page-title">내 카드</h1>
        <div class="toolbar">
            <button id="btn-refresh-my-cards" class="btn">새로고침</button>
            <span id="my-cards-status" class="muted">내가 생성한 카드 목록입니다.</span>
        </div>
        <div id="my-cards-grid" class="card-grid"></div>
    </section>

    <section id="view-gen-hub">
      <h1 class="page-title">생성</h1>
      <div class="gen-hub-container">
        <div class="gen-hub-item" id="btn-goto-gen-char">
          <h2>AI 캐릭터 생성</h2>
          <p>AI의 도움을 받아 세상에 하나뿐인 당신의 캐릭터를 만드세요.</p>
        </div>
        <div class="gen-hub-item" id="btn-goto-gen-card">
          <h2>AI 카드 생성</h2>
          <p>독창적인 아이디어로 새로운 카드를 만들어 게임의 메타를 바꾸세요.</p>
        </div>
      </div>
    </section>

    <section id="view-gen-char">
        <div class="page-header">
          <button class="btn btn-back" data-target="view-gen-hub">&lt; 뒤로가기</button>
          <h1 class="page-title">AI 캐릭터 생성</h1>
        </div>
        <div class="toolbar">
          <textarea id="gen-char-prompt" placeholder="만들고 싶은 캐릭터의 아이디어를 150자 내로 자유롭게 적어주세요. (예: 강력한 방어력과 재생 능력을 가진 강철 골렘)" maxlength="150"></textarea>
          <label>창의성 <input id="gen-char-temp" type="number" step="0.1" min="0" max="1" value="0.8" style="width:80px"></label>
          <button id="btn-gen-char" class="btn primary">Generate (1명)</button>
          <span id="gen-char-status" class="muted"></span>
        </div>
        <div id="gen-char-results" class="card-grid"></div>
    </section>

    <section id="view-gen">
      <div class="page-header">
        <button class="btn btn-back" data-target="view-gen-hub">&lt; 뒤로가기</button>
        <h1 class="page-title">AI 카드 생성</h1>
      </div>
      <div class="toolbar">
        <textarea id="gen-prompt" placeholder="만들고 싶은 카드의 아이디어를 150자 내로 자유롭게 적어주세요." maxlength="150"></textarea>
        <label>창의성 <input id="gen-temp" type="number" step="0.1" min="0" max="1" value="0.8" style="width:80px"></label>
        <button id="btn-gen-cards" class="btn primary">Generate (1장)</button>
        <span id="gen-status" class="muted"></span>
      </div>
      <div id="gen-results" class="card-grid"></div>
    </section>
  </main>

  <nav class="bottom-nav">
    <div class="bottom-nav__tabs">
      <button data-tab="view-lobby" class="active">로비</button>
      <button data-tab="view-my-characters">내 캐릭터</button>
      <button data-tab="view-my-cards">내 카드</button>
      <button data-tab="view-gen-hub">생성</button>
    </div>
    <div class="bottom-nav__user">
      <button id="btn-google" class="btn">Google 로그인</button>
    </div>
  </nav>

  <div id="nickname-modal" style="display:none;">
    <div class="card">
      <div class="card__body">
        <h3>닉네임 설정</h3>
        <p class="muted">게임에서 사용할 닉네임을 입력해주세요.</p>
        <input id="nickname-input" maxlength="12" placeholder="2~12자 닉네임" style="width:100%; margin: 10px 0;" />
        <div style="display:flex; gap:8px; margin-top:8px; align-items:center;">
          <button id="nickname-save" class="btn primary">저장</button>
          <span id="nickname-error" class="danger"></span>
        </div>
      </div>
    </div>
  </div>

  <script src="./js/firebase-config.js"></script>
  <script type="module" src="./js/app.js"></script>
</body>
</html>
