<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://www.gstatic.com https://apis.google.com;
  connect-src 'self'
    https://firestore.googleapis.com
    https://identitytoolkit.googleapis.com
    https://securetoken.googleapis.com
    https://firebaseinstallations.googleapis.com
    https://www.googleapis.com
    https://www.gstatic.com
    https://us-central1-peaceful-doodad-471301-s2.cloudfunctions.net;
  frame-src 'self' https://accounts.google.com https://apis.google.com https://www.gstatic.com;
  img-src 'self' data: https:;
  style-src 'self' 'unsafe-inline';
">

  <title>TaleField — MVP</title>

  <style id="theme-tokens">
  :root{
    --attr-fire:#E4572E; --attr-water:#3A86FF; --attr-wind:#2FBF71;
    --attr-earth:#A07949; --attr-light:#E9D758; --attr-dark:#6C5CE7;
    --attr-neutral:#8D99AE;
    --radius-16:16px; --elev-1:0 2px 10px rgba(0,0,0,.12);
  }
  body{ font-family: system-ui, AppleSDGothicNeo, 'Segoe UI', Roboto, sans-serif; margin:0; }
  header{ display:flex; gap:8px; align-items:center; padding:10px 12px; border-bottom:1px solid #ddd; position:sticky; top:0; background:#fff; }
  header .tabs button{ padding:8px 12px; border-radius:12px; border:1px solid #ccc; background:#f7f7f7; }
  section{ display:none; padding:14px; }
  section.active{ display:block; }
  .card-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:12px; }
  .card{ border-radius:var(--radius-16); box-shadow:var(--elev-1); border:1px solid #ddd; overflow:hidden; }
  .card--character{ border:2px solid var(--attr-neutral); }
  .card--skill .card__title{ color:#fff; padding:.45rem .6rem; }
  .card--character[data-attr="fire"]{ border-color:var(--attr-fire);}
  .card--character[data-attr="water"]{ border-color:var(--attr-water);}
  .card--character[data-attr="wind"]{ border-color:var(--attr-wind);}
  .card--character[data-attr="earth"]{ border-color:var(--attr-earth);}
  .card--character[data-attr="light"]{ border-color:var(--attr-light);}
  .card--character[data-attr="dark"]{ border-color:var(--attr-dark);}
  .card--skill[data-attr="fire"] .card__title{ background:var(--attr-fire);}
  .card--skill[data-attr="water"] .card__title{ background:var(--attr-water);}
  .card--skill[data-attr="wind"] .card__title{ background:var(--attr-wind);}
  .card--skill[data-attr="earth"] .card__title{ background:var(--attr-earth);}
  .card--skill[data-attr="light"] .card__title{ background:var(--attr-light); color:#222;}
  .card--skill[data-attr="dark"] .card__title{ background:var(--attr-dark);}
  .muted{ color:#666; font-size:.9rem; }
  .toolbar{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:10px; }
  .tag{ font-size:.8rem; background:#eee; border-radius:999px; padding:2px 8px; margin-right:6px; }
  .danger{ color:#b00020; } .ok{ color:#0a8033; }
  .btn{ padding:8px 12px; border-radius:10px; border:1px solid #ccc; background:#fafafa; cursor:pointer; }
  .btn.primary{ background:#222; color:#fff; border-color:#111; }
  .right{ margin-left:auto; }
  </style>

  <script src="./js/firebase-config.js"></script>
  <script type="module" src="./js/firebase.js"></script>
  <script type="module" src="./js/engine.js"></script>
  <script type="module" src="./js/app.js"></script>
</head>
<body>
  <header>
    <strong>TaleField</strong>
    <div class="tabs">
      <button data-tab="view-lobby">로비</button>
      <button data-tab="view-room">방/플레이</button>
      <button data-tab="view-gen">생성(Gen)</button>
    </div>
    <div class="right">
      <button id="btn-google">Google 로그인</button>
      <button id="btn-logout">로그아웃</button>
    </div>
  </header>

  <section id="view-lobby" class="active">
    <h2>로비</h2>
    <p class="muted">방 목록, 참여/생성은 차후 연결. 우선 생성 탭부터 완성할게.</p>
  </section>

  <section id="view-room">
    <h2>방/플레이</h2>
    <p class="muted">턴/페이즈/스택/지연효과는 engine.js로 테스트 가능. 서버 권위는 이후 Functions로 이전.</p>
    <div id="sandbox"></div>
  </section>

  <section id="view-gen">
    <h2>카드 생성 (Gemini 1.5 Flash)</h2>
    <div class="toolbar">
      <textarea id="gen-prompt" placeholder="만들고 싶은 카드의 아이디어를 150자 내로 자유롭게 적어주세요. (예: '적에게 피해를 주면서 내 손패를 버리는 리스크가 있는 카드')" style="width: 100%; min-height: 60px; margin-bottom: 8px;" maxlength="150"></textarea>
      <label>생성 개수 <input id="gen-count" type="number" value="6" min="1" max="12" style="width:60px"></label>
      <label>최대 파워 <input id="gen-power" type="number" value="10" min="1" max="20" style="width:70px"></label>
      <label>창의성 <input id="gen-temp" type="number" step="0.1" min="0" max="1" value="0.8" style="width:70px"></label>
      <button id="btn-gen-cards" class="btn primary">Generate</button>
      <button id="btn-accept-selected" class="btn">선택 저장</button>
      <span id="gen-status" class="muted"></span>
    </div>

    <div id="gen-results" class="card-grid"></div>
  </section>

  <div id="nickname-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.35);">
    <div class="card" style="max-width:420px; margin:10vh auto; padding:14px;">
      <h3>닉네임 설정</h3>
      <input id="nickname-input" maxlength="12" placeholder="2~12자 닉네임" />
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button id="nickname-save" class="btn primary">저장</button>
        <span id="nickname-error" class="danger"></span>
      </div>
    </div>
  </div>
</body>
</html>
