<!doctype html>
<html lang="ko">
<head>
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://www.gstatic.com https://apis.google.com;
  connect-src 'self' https://firestore.googleapis.com https://www.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com https://www.gstatic.com https://firebasestorage.googleapis.com https://firebaseinstallations.googleapis.com;
  frame-src 'self' https://accounts.google.com https://apis.google.com https://www.gstatic.com;
  img-src 'self' data: https:;
  style-src 'self' 'unsafe-inline';
">


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaleField — MVP</title>
  <style>
    :root { --bg:#0b0f14; --panel:#121821; --ink:#e6f3ff; --ink-dim:#a8bfd6; --accent:#79c2ff; --line:#223046; --danger:#ff6b6b; }
    * { box-sizing:border-box; }
    body { margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--ink); }
    .topbar { position:sticky; top:0; z-index:10; display:flex; align-items:center; gap:12px; padding:12px 16px; background:#0d131b; border-bottom:1px solid var(--line); }
    .topbar h1 { font-size:18px; margin:0; }
    .topbar .user { margin-left:auto; color:var(--ink-dim); font-size:12px; }
    main { max-width:1100px; margin:0 auto; padding:16px; }
    .tabs { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
    .tabs button { background:#162232; color:var(--ink); border:1px solid var(--line); padding:8px 12px; border-radius:10px; cursor:pointer; }
    .tabs button.active { outline:2px solid var(--accent); }
    .tab { display:none; }
    .tab.active { display:block; }
    .panel { background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:16px; margin-bottom:16px; }
    .row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .row.spread { justify-content:space-between; }
    .list, .grid, .hand { list-style:none; padding:0; margin:0; }
    .list li { padding:10px; border-bottom:1px solid var(--line); display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(240px,1fr)); gap:10px; margin-top:10px; }
    .cardbox { border:1px solid var(--line); border-radius:12px; padding:10px; background:#0f151e; display:flex; gap:8px; }
    .cardbox h4 { margin:0 0 4px 0; font-size:14px; }
    .hint { color:var(--ink-dim); font-size:12px; }
    .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .log { background:#0f151e; border:1px solid var(--line); border-radius:12px; padding:10px; height:260px; overflow:auto; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color:var(--ink-dim); }
    .react-queue { min-height:44px; display:flex; gap:8px; align-items:center; }
    .react-pill { border:1px dashed var(--line); border-radius:999px; padding:6px 10px; }
    input, button, select { background:#0f151e; color:var(--ink); border:1px solid var(--line); padding:8px 10px; border-radius:10px; }
    input[type="number"] { width:90px; }
    button.primary { background:#183350; border-color:#274767; }
    .toast { position:fixed; right:16px; bottom:16px; background:#132233; color:var(--ink); border:1px solid var(--line); padding:10px 14px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,.35); display:none; }
    @media (max-width:900px){ .grid-2 { grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <header class="topbar">
  <h1>🥥 TaleField (MVP)</h1>
  <div class="row" style="margin-left:auto; gap:8px;">
    <button id="btnGoogleLogin">Google 로그인</button>
    <button id="btnLogout" style="display:none;">로그아웃</button>
    <div class="user" id="userBox">로그인 중…</div>
  </div>
</header>

  <main>
    <nav class="tabs">
      <button data-tab="home" class="active">홈</button>
      <button data-tab="cards">카드 선택</button>
      <button data-tab="game">인게임</button>
    </nav>

    <section id="tab-home" class="tab active">
      <div class="panel">
        <h2>방 만들기</h2>
        <div class="row">
          <label>방 제목 <input id="roomTitle" placeholder="예: 형원이의 방" /></label>
          <label>최대 인원 <input id="roomMax" type="number" value="8" min="2" max="8" /></label>
          <button id="btnCreateRoom" class="primary">방 생성</button>
        </div>
      </div>
      <div class="panel">
        <div class="row spread">
          <h2 style="margin:0">방 목록</h2>
          <div class="hint">최근 생성 순 · 자동 새로고침</div>
        </div>
        <ul id="roomList" class="list"></ul>
      </div>
    </section>

    <section id="tab-cards" class="tab">
      <div class="panel">
        <div class="row spread">
          <h2 style="margin:0">내 카드 (승인된 것 5~10장 선택)</h2>
          <div class="row">
            <div class="hint">현재 방: <span id="currentRoomId">(없음)</span></div>
            <button id="btnRefreshCards">새로고침</button>
          </div>
        </div>
        <ul id="myCards" class="grid"></ul>
        <div class="row spread" style="margin-top:8px;">
          <div>선택: <strong id="selectedCount">0</strong>장</div>
          <button id="btnSubmitCards" class="primary">선택 카드 제출</button>
        </div>
      </div>
    </section>

    <section id="tab-game" class="tab">
      <div class="panel">
        <h2>인게임</h2>
        <div class="row" style="margin:8px 0;">
          <button id="btnDraw" class="primary">드로우</button>
          <button id="btnPass">패스</button>
          <div class="hint">드로우/패스는 메인 페이즈에만 가능 · 반응 창에서는 불가</div>
        </div>

    <div class="grid-2">
          <div>
            <h3>내 상태</h3>
            <div id="myState">HP: -, 기력: -, 손패: -</div>
            <h3>손패</h3>
            <ul id="myHand" class="hand"></ul>
          </div>
          <div>
            <h3>로그</h3>
            <div id="logBox" class="log"></div>
            <h3>반응 큐(최대 2)</h3>
            <div id="reactQueue" class="react-queue"><span class="hint">(비어있음)</span></div>
          </div>
        </div>
                <div class="panel" style="margin-top:12px;">
                  <h3>채팅</h3>
                  <div id="chatLog" class="log" style="height:160px;"></div>
                  <div class="row" style="margin-top:8px;">
                    <input id="chatInput" placeholder="메시지 입력…" style="flex:1;" />
                    <button id="btnSendChat" class="primary">전송</button>
                  </div>
                  <div class="hint">5초에 5회 이상 전송 시 잠시 제한돼. 링크 미리보기 안 함, 텍스트만 표시.</div>
                </div>

      </div>
    </section>
  </main>

  <div id="toast" class="toast"></div>
  <script src="js/firebase-config.js"></script>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
